<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="WMB Edmands" />

<meta name="date" content="2016-06-22" />

<title>CompMS2miner_Workflow</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">CompMS2miner_Workflow</h1>
<h4 class="author"><em>WMB Edmands</em></h4>
<h4 class="date"><em>June 22, 2016</em></h4>



<p>Matches MS1 features to MS2 spectra (.mzXML) files based on a mass-to-charge and retention time tolerance. Composite spectra and other data can subsequently be visualized during any stage of the CompMS2miner processing workflow. Composite spectra can be denoised, ion signals grouped and summed, substructure groups identified, common Phase II metabolites predicted, calculation of a correlation network and features matched to data bases monoisotopic mass data and insilico MS2 fragmentation data. The resulting data can then be readily curated by publishing as online shiny application on shinyapps.io, as a zip file which can be shared or by sending to a local or online couchDB database.</p>
<p>At any stage during the compMS2 workflow a compMS2 class object can be visualized with a Shiny application <em>compMS2explorer</em>. Full usage of the <em>compMS2explorer</em> application functionality requires an internet connection. The end result of following the workflow within this document using the example data provided can be visualized using the function, comments made in the metID comments tab can be saved on closing the application by assigning the compMS2explorer output to an object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(CompMS2miner)
<span class="co"># assign any metabolite identification comments to a new or the same &quot;CompMS2&quot; object</span>
compMS2example_commented &lt;-<span class="st"> </span><span class="kw">compMS2explorer</span>(compMS2example)</code></pre></div>
<p>The following example illustrates the CompMS2miner workflow:</p>
<div id="construct-compms2-class-object." class="section level2">
<h2>1. construct compMS2 class object.</h2>
<p>From MS2 data (in the .mzXML file format) and an MS1feature table. The compMS2 object can also be constructed in as a parallel computation in the case of large peak tables and/ or larger numbers of MS2 data files.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># file path example MS1features in comma delimited csv file </span>
<span class="co"># (see ?example_mzXML_MS1features for details).</span>
MS1features_example &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;MS1features_example.csv&quot;</span>, 
                                   <span class="dt">package =</span> <span class="st">&quot;CompMS2miner&quot;</span>)
<span class="co"># mzXml file examples directory</span>
mzXmlDir_example &lt;-<span class="st"> </span><span class="kw">dirname</span>(MS1features_example)
<span class="co"># observation MS1 feature table column names character vector for corrNetwork function</span>
obsNames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">paste0</span>(<span class="kw">rep</span>(<span class="st">&quot;ACN_80_&quot;</span>, <span class="dv">6</span>), <span class="kw">rep</span>(LETTERS[<span class="dv">1</span>:<span class="dv">3</span>], <span class="dt">each=</span><span class="dv">2</span>), <span class="kw">rep</span>(<span class="dv">1</span>:<span class="dv">2</span>, <span class="dv">3</span>)),
              <span class="kw">paste0</span>(<span class="kw">rep</span>(<span class="st">&quot;MeOH_80_&quot;</span>, <span class="dv">6</span>), <span class="kw">rep</span>(LETTERS[<span class="dv">1</span>:<span class="dv">3</span>], <span class="dt">each=</span><span class="dv">2</span>), <span class="kw">rep</span>(<span class="dv">1</span>:<span class="dv">2</span>, <span class="dv">3</span>)))
<span class="co"># use parallel package to detect number of cores</span>
nCores &lt;-<span class="st"> </span>parallel::<span class="kw">detectCores</span>()

<span class="co"># read in example peakTable</span>
peakTable &lt;-<span class="st"> </span><span class="kw">read.csv</span>(MS1features_example, <span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>) 
<span class="co"># create compMS2 object</span>
compMS2demo &lt;-<span class="st"> </span><span class="kw">compMS2</span>(<span class="dt">MS1features =</span> peakTable,
                       <span class="dt">mzXMLdir =</span> mzXmlDir_example, <span class="dt">nCores=</span>nCores,
                       <span class="dt">mode =</span> <span class="st">&quot;pos&quot;</span>, <span class="dt">precursorPpm =</span> <span class="dv">10</span>, <span class="dt">ret =</span> <span class="dv">20</span>, 
                       <span class="dt">TICfilter =</span> <span class="dv">10000</span>)
## creating compMS2 object in positive ionisation mode
## 2 MS2 (.mzXML) files were detected within the directory...
## Starting SNOW cluster with 8 local sockets...
## matching MS1 peak table features to the following MS2 files:
## DDA_ACN_80.mzXML
## DDA_MeOH_80.mzXML
## 
## &quot;obsNames&quot; in argsCorrNetwork argument missing. Not performing correlation network calculation.

<span class="co"># View summary of compMS2 class object at any time </span>
compMS2demo
## A &quot;CompMS2&quot; class object derived from 2 MS2 files 
## 
## 202 MS1 features were matched to 2514 MS2 precursor scans
## containing 323968 ion features
## 
## Average ppm match accuracy: 1.979 
## with a ppm mass accuracy tolerance of (+/-) 10 
## 
## Average retention time match accuracy: 6.85 seconds
## with a retention time tolerance of (+/-) 20  seconds
## 
## Memory usage: 6.53 MB</code></pre></div>
</div>
<div id="dynamic-noise-filtration." class="section level2">
<h2>2. Dynamic noise filtration.</h2>
<p>filter variable noise from the data using a dynamic noise filter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># dynamic noise filter</span>
compMS2demo &lt;-<span class="st"> </span><span class="kw">deconvNoise</span>(compMS2demo, <span class="st">&quot;DNF&quot;</span>)
## Applying dynamic noise filter to 327 spectra...
## Starting SNOW cluster with 8 local sockets...
## ...done
## 326 spectra contained more than or equal to 3 peaks following dynamic noise filtration
<span class="co"># View summary of compMS2 class object at any time </span>
compMS2demo 
## A &quot;CompMS2&quot; class object derived from 2 MS2 files 
## 
## 202 MS1 features were matched to 2512 MS2 precursor scans
## containing 6425 ion features
## 
## Average ppm match accuracy: 1.983 
## with a ppm mass accuracy tolerance of (+/-) 10 
## 
## Average retention time match accuracy: 6.87 seconds
## with a retention time tolerance of (+/-) 20  seconds
## 
## Memory usage: 1.74 MB</code></pre></div>
</div>
<div id="intra-spectrum-ion-grouping-and-inter-ms2-file-spectra-grouping-with-signal-summing." class="section level2">
<h2>3. Intra-spectrum ion grouping and inter-MS2 file spectra grouping with signal summing.</h2>
<p>group and sum ions from different scans and then combine summed ion composite spectra across multiple files. This create a single composite spectra for each MS1 EIC matched to MS2 precursor scans.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># intra-spectrum ion grouping and signal summing</span>
compMS2demo &lt;-<span class="st"> </span><span class="kw">combineMS2</span>(compMS2demo, <span class="st">&quot;Ions&quot;</span>)
## Grouping ions in 326 spectra...
## Starting SNOW cluster with 8 local sockets...
## ...done
## 311 spectra contained more than or equal to 3 peaks following ion grouping
## The range of interfragment differences less than 0.1 m/z in the spectra is min : 1 max : 4
## The average number of interfragment differences less than 0.1 m/z in the spectra is 1
<span class="co"># View summary of compMS2 class object at any time </span>
compMS2demo
## A &quot;CompMS2&quot; class object derived from 2 MS2 files 
## 
## 198 MS1 features were matched to 2347 MS2 precursor scans
## containing 2166 ion features
## 
## Average ppm match accuracy: 1.997 
## with a ppm mass accuracy tolerance of (+/-) 10 
## 
## Average retention time match accuracy: 6.83 seconds
## with a retention time tolerance of (+/-) 20  seconds
## 
## Memory usage: 1.9 MB
<span class="co">#inter spectrum ion grouping and signal summing</span>
compMS2demo &lt;-<span class="st"> </span><span class="kw">combineMS2</span>(compMS2demo, <span class="st">&quot;Spectra&quot;</span>) 
## Combining 311 spectra by MS1 feature number...
## Starting SNOW cluster with 8 local sockets...
## ...done
## 198 composite spectra contained more than or equal to 3 peaks following ion grouping
## The range of interfragment differences less than 0.1 m/z in the composite spectra is min : 1 max : 5
## The average number of interfragment differences less than 0.1 m/z in the composite spectra is 1
<span class="co"># View summary of compMS2 class object at any time </span>
compMS2demo
## A &quot;CompMS2&quot; class object derived from 2 MS2 files 
## 
## 198 MS1 features were matched to 2347 MS2 precursor scans
## containing 1576 ion features
## 
## Average ppm match accuracy: 2.084 
## with a ppm mass accuracy tolerance of (+/-) 10 
## 
## Average retention time match accuracy: 6.83 seconds
## with a retention time tolerance of (+/-) 20  seconds
## 
## Memory usage: 1.83 MB</code></pre></div>
</div>
<div id="possible-substructure-identification." class="section level2">
<h2>4. Possible substructure identification.</h2>
<p>Characteristic neutral losses/ fragments of electrospray adducts and metabolites from literature sources (?Substructure_masses for details).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># annotate substructures</span>
compMS2demo &lt;-<span class="st"> </span><span class="kw">subStructure</span>(compMS2demo, <span class="st">&quot;Annotate&quot;</span>)
## matching Precursor to fragment and interfragment neutral losses and fragments in 198 composite spectra
<span class="co"># identify most probable substructure annotation based on total relative intensity</span>
<span class="co"># explained</span>
compMS2demo &lt;-<span class="st"> </span><span class="kw">subStructure</span>(compMS2demo, <span class="st">&quot;prob&quot;</span>)
## Identifying likely substructure type...
<span class="co"># summary of most probable substructure annotation</span>
mostProbSubStr &lt;-<span class="st"> </span><span class="kw">subStructure</span>(compMS2demo, <span class="st">&quot;probSummary&quot;</span>)
## Substructure annotation summary : 
## 198 composite spectra 
## 183 substructures identified above minimum sum relative intensity of 30 
## 
## SubStr.table
##                                      phosphatidylcholine 
##                                                       99 
##                                    methionine side chain 
##                                                       43 
##                                             polysiloxane 
##                                                       30 
##                                                phthalate 
##                                                        4 
##                       carboxylic acids, aldehydes, ester 
##                                                        2 
##                         nitroaromatics, hydroxyaldehydes 
##                                                        2 
## aromatic n-methylamines, methoxy derivative, tert. butyl 
##                                                        1 
##                                            methyl esters 
##                                                        1 
##                                                triazines 
##                                                        1</code></pre></div>
</div>
<div id="metabolite-identification-methods." class="section level2">
<h2>5. Metabolite identification methods.</h2>
<p>A variety of metabolite identification methods are implemented through the function metID (see ?metID) for further details.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># annotate composite MS2 matched MS1 features to metabolomic databases (default</span>
<span class="co">#is HMDB, also DrugBank, T3DB and ReSpect databases can also be queried).</span>
<span class="co">#Warning: this may take 2-3 mins as large number of query masses</span>
compMS2demo &lt;-<span class="st"> </span><span class="kw">metID</span>(compMS2demo, <span class="st">&quot;dbAnnotate&quot;</span>)
## matching 198 unknowns to 8,902,538 possible ESI artefacts and substructure mass shifts...

<span class="co"># select most probable annotations based on substructures detected</span>
compMS2demo &lt;-<span class="st"> </span><span class="kw">metID</span>(compMS2demo, <span class="st">&quot;dbProb&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># match composite spectra to spectral databases as .msp files (e.g. lipidBlast, source http://prime.psc.riken.jp/Metabolomics_Software/MS-DIAL/LipidBlast_Posi_Plasma_vs2.msp)</span>
compMS2demo &lt;-<span class="st"> </span><span class="kw">metID</span>(compMS2demo, <span class="st">'matchSpectralDB'</span>,
                     <span class="dt">mspFile=</span><span class="st">'http://prime.psc.riken.jp/Metabolomics_Software/MS-DIAL/LipidBlast_Posi_Plasma_vs2.msp'</span>)
<span class="co"># massBank .msp</span>
compMS2demo &lt;-<span class="st"> </span><span class="kw">metID</span>(compMS2demo, <span class="st">'matchSpectralDB'</span>,
                     <span class="dt">mspFile=</span><span class="st">'http://prime.psc.riken.jp/Metabolomics_Software/MS-DIAL/MassBank_MSMS_Pos_Rev173_vs1.msp'</span>)

<span class="co"># ReSpect .msp</span>
compMS2demo &lt;-<span class="st"> </span><span class="kw">metID</span>(compMS2demo, <span class="st">'matchSpectralDB'</span>, 
                     <span class="dt">mspFile=</span><span class="st">'http://prime.psc.riken.jp/Metabolomics_Software/MS-DIAL/Respect_20120925_ESI_Positive_MSMS.msp'</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># predict Phase II metabolites from SMILES codes</span>
compMS2demo &lt;-<span class="st"> </span><span class="kw">metID</span>(compMS2demo, <span class="st">&quot;predSMILES&quot;</span>)

<span class="co"># metFrag insilico fragmentation.</span>
compMS2demo &lt;-<span class="st"> </span><span class="kw">metID</span>(compMS2demo, <span class="st">&quot;metFrag&quot;</span>)</code></pre></div>
<div id="spectral-similarity-network-metmsline-data-preprocessing-and-correlation-network-calculation." class="section level3">
<h3>spectral similarity network, MetMSLine data-preprocessing and correlation network calculation.</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate spectral similarity network (dot product &gt;= 0.8 default)</span>
compMS2demo &lt;-<span class="st"> </span><span class="kw">metID</span>(compMS2demo, <span class="st">'specSimNetwork'</span>)
## 184 nodes with 2430 edges identified at a spectral similarity (dot product score) &gt;= 0.8
## Of the edges:
## 2271 were based on a shared ion fragment pattern
## 159 were based on a shared neutral loss pattern
##############################################################
### data pre-processing MS1features with MetMSLine package ###
##############################################################

if(!<span class="kw">require</span>(MetMSLine)){
  <span class="co"># if not installed then install from github</span>
  devtools::<span class="kw">install_github</span>(<span class="st">'WMBEdmands/MetMSLine'</span>)
  <span class="kw">require</span>(MetMSLine)
}

<span class="co"># zero fill</span>
peakTable &lt;-<span class="st"> </span><span class="kw">zeroFill</span>(peakTable, obsNames)
## zero filling with half the minimum non-zero value
<span class="co"># log transform</span>
peakTable &lt;-<span class="st"> </span><span class="kw">logTrans</span>(peakTable, obsNames)
## log transforming to the base 2.718...

########################################################
######### end MetMSLine pre-processing #################
########################################################

<span class="co"># add correlation network using pre-processed MS2 matched peak table</span>
compMS2demo &lt;-<span class="st"> </span><span class="kw">metID</span>(compMS2demo, <span class="dt">method=</span><span class="st">'corrNetwork'</span>, peakTable, obsNames,
                     <span class="dt">corrMethod=</span><span class="st">'pearson'</span>, <span class="dt">corrThresh=</span><span class="fl">0.95</span>, <span class="dt">MTC=</span><span class="st">'none'</span>, <span class="dt">MS2only=</span><span class="dv">3</span>)
## Calculating correlation matrix for 198 features
## less than 300 nodes using Fruchterman-Reingold layout. see ?igraph::with_fr()
## 141 nodes with 595 edges identified at a correlation threshold &gt;= 0.95 (pearson, p/q value &lt;= 0.05, MTC: none)</code></pre></div>
</div>
</div>
<div id="optional-curate-data-as-zip-file-in-couchdb-andor-publish-results-as-a-shiny-application." class="section level2">
<h2>6. Optional curate data as zip file, in CouchDB and/or publish results as a shiny application.</h2>
<p>CompMS2 class objects can be sent to either a local or online couchDB database. Furthermore, the results of the CompMS2miner workflow can be published on the web as a shiny application to share metabolite identification information or as a self-contained zip file using the publishApp function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># publish your app to shinyapps.io see ?publishApp for more details</span>
<span class="co"># you may need to install the rsconnect and shinyapps packages and also sign up for a shinyapps.io account if you don't have one.</span>
<span class="co"># quick guide here for setting up your account: http://shiny.rstudio.com/articles/shinyapps.html</span>
<span class="kw">publishApp</span>(compMS2demo, <span class="dt">appName=</span><span class="st">'compMS2demo'</span>)</code></pre></div>
</div>
<div id="sessioninfo" class="section level1">
<h1>sessionInfo</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 3.3.0 (2016-05-03)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 7 x64 (build 7601) Service Pack 1
## 
## locale:
## [1] LC_COLLATE=English_United States.1252 
## [2] LC_CTYPE=English_United States.1252   
## [3] LC_MONETARY=English_United States.1252
## [4] LC_NUMERIC=C                          
## [5] LC_TIME=English_United States.1252    
## 
## attached base packages:
## [1] tcltk     stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] scales_0.4.0        rhandsontable_0.3.1 CompMS2miner_1.2.2 
##  [4] MetMSLine_1.0.0     fastcluster_1.1.20  fpc_2.1-10         
##  [7] zoo_1.7-13          tcltk2_1.2-11       igraph_1.0.1       
## [10] shiny_0.13.2        Rcpp_0.12.5         foreach_1.4.3      
## [13] devtools_1.11.1    
## 
## loaded via a namespace (and not attached):
##  [1] mclust_5.2            mvtnorm_1.0-5         lattice_0.20-33      
##  [4] class_7.3-14          snow_0.4-1            digest_0.6.9         
##  [7] mime_0.4              slam_0.1-34           R6_2.1.2             
## [10] plyr_1.8.4            stats4_3.3.0          evaluate_0.9         
## [13] httr_1.2.0            diptest_0.75-7        curl_0.9.7           
## [16] kernlab_0.9-24        DT_0.1.45             rmarkdown_0.9.6      
## [19] stringr_1.0.0         htmlwidgets_0.6       RCurl_1.95-4.8       
## [22] munsell_0.4.3         compiler_3.3.0        httpuv_1.3.3         
## [25] htmltools_0.3.5       doSNOW_1.0.14         nnet_7.3-12          
## [28] codetools_0.2-14      XML_3.98-1.4          withr_1.0.1          
## [31] MASS_7.3-45           bitops_1.0-6          grid_3.3.0           
## [34] jsonlite_0.9.22       xtable_1.8-2          git2r_0.15.0         
## [37] magrittr_1.5          formatR_1.4           stringi_1.1.1        
## [40] reshape2_1.4.1        NLP_0.1-9             flexmix_2.3-13       
## [43] robustbase_0.92-5     wordcloud_2.5         RColorBrewer_1.1-2   
## [46] iterators_1.0.8       tools_3.3.0           PubMedWordcloud_0.3.2
## [49] trimcluster_0.1-2     DEoptimR_1.0-4        rsconnect_0.4.3      
## [52] parallel_3.3.0        yaml_2.1.13           tm_0.6-2             
## [55] colorspace_1.2-6      cluster_2.0.4         prabclus_2.2-6       
## [58] memoise_1.0.0         knitr_1.13            modeltools_0.2-21</code></pre>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
